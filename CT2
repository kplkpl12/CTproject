<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>화학반응식 계수 맞추기</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f9f9f9; }
    h1 { color: #d35400; }
    select, button, input { padding: 8px; margin: 5px; }
    .question, .settings { background: #fbe9e7; padding: 15px; border-radius: 8px; margin-top: 20px; }
    .result { font-weight: bold; margin-top: 10px; }
    .correct { color: green; }
    .incorrect { color: red; }
    .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border: 1px solid #ccc; padding: 20px; z-index: 1000; }
    .overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 999; }
  </style>
</head>
<body>
  <h1>화학반응식 계수 맞추기</h1>
  <p><strong>대상 및 교과:</strong> 중3 과학</p>

  <div class="settings">
    <label>난이도 (빈칸 개수):</label>
    <select id="difficulty">
      <option value="1">1개</option>
      <option value="2">2개</option>
      <option value="3">3개</option>
    </select>
    <label>제한 시간:</label>
    <select id="timeLimit">
      <option value="30">30초</option>
      <option value="60">1분</option>
    </select>
    <button onclick="startQuiz()">문제 풀기</button>
  </div>

  <div class="question" id="questionBox" style="display:none;">
    <p><strong>지문:</strong><br>화학반응식의 계수를 맞추어보자.</p>
    <p><strong>규칙:</strong><br>
      - 화학반응식의 가운데에는 화살표(→)가 있다.<br>
      - 이 화살표의 왼쪽에 있는 모든 원소는 오른쪽에도 존재한다.<br>
      - <strong>각 원소의 개수는 화살표 양쪽에서 같아야 한다.</strong>
    </p>
    <p><strong>보기:</strong></p>
    <p id="reaction"></p>
    <p><strong>문제:</strong> 네모칸에 들어갈 계수는?</p>
    <div id="inputs"></div>
    <button onclick="checkReaction()">확인</button>
    <p class="result" id="result"></p>
  </div>

  <div class="overlay" id="overlay"></div>
  <div class="modal" id="timeoutModal">
    <p>⏰ 시간이 끝났습니다!</p>
    <button onclick="restartQuiz()">다시 시작</button>
  </div>

  <script>
    const reactions = [
      { equation: ['_H2 + _O2 → _H2O'], answer: [2, 1, 2] },
      { equation: ['_C + _O2 → _CO2'], answer: [1, 1, 1] },
      { equation: ['_Mg + _O2 → _MgO'], answer: [2, 1, 2] },
      { equation: ['_H2O2 → _H2O + _O2'], answer: [2, 2, 1] },
      { equation: ['_Zn + _HCl → _ZnCl2 + _H2'], answer: [1, 2, 1, 1] },
      { equation: ['_Na + _Cl2 → _NaCl'], answer: [2, 1, 2] },
      { equation: ['_CaCO3 → _CaO + _CO2'], answer: [1, 1, 1] },
      { equation: ['_Fe + _S → _FeS'], answer: [1, 1, 1] },
      { equation: ['_K + _H2O → _KOH + _H2'], answer: [2, 2, 2, 1] },
      { equation: ['_Cu + _AgNO3 → _Cu(NO3)2 + _Ag'], answer: [1, 2, 1, 2] },
      { equation: ['_CH4 + _O2 → _CO2 + _H2O'], answer: [1, 2, 1, 2] },
      { equation: ['_Al + _Cl2 → _AlCl3'], answer: [2, 3, 2] },
      { equation: ['_N2 + _H2 → _NH3'], answer: [1, 3, 2] },
      { equation: ['_Na2CO3 + _HCl → _NaCl + _CO2 + _H2O'], answer: [1, 2, 2, 1, 1] },
      { equation: ['_Fe + _Cl2 → _FeCl3'], answer: [2, 3, 2] }
    ];

    let currentReaction;
    let timer;
    let timerRunning = false;

    function startQuiz() {
      clearTimeout(timer);
      timerRunning = true;

      document.getElementById('result').textContent = '';
      document.getElementById('result').className = 'result';
      document.getElementById('questionBox').style.display = 'block';

      const difficulty = parseInt(document.getElementById('difficulty').value);
      const timeLimit = parseInt(document.getElementById('timeLimit').value);

      currentReaction = reactions[Math.floor(Math.random() * reactions.length)];
      let display = currentReaction.equation[0];
      const inputsDiv = document.getElementById('inputs');
      inputsDiv.innerHTML = '';

      const blankIndices = [];
      while (blankIndices.length < difficulty) {
        let idx = Math.floor(Math.random() * currentReaction.answer.length);
        if (!blankIndices.includes(idx)) blankIndices.push(idx);
      }
      blankIndices.sort((a, b) => b - a);

      blankIndices.forEach(i => {
        display = display.replace('_', `<input type=\"number\" id=\"input${i}\" size=\"1\" style=\"width:40px;\">`);
      });

      for (let i = 0; i < currentReaction.answer.length; i++) {
        if (!blankIndices.includes(i)) {
          display = display.replace('_', currentReaction.answer[i]);
        }
      }

      document.getElementById('reaction').innerHTML = display;

      timer = setTimeout(() => {
        timerRunning = false;
        document.getElementById('overlay').style.display = 'block';
        document.getElementById('timeoutModal').style.display = 'block';
      }, timeLimit * 1000);
    }

    function checkReaction() {
      const inputs = document.querySelectorAll('input[type="number"]');
      let correct = true;
      inputs.forEach(input => {
        const index = parseInt(input.id.replace('input', ''));
        if (parseInt(input.value) !== currentReaction.answer[index]) {
          correct = false;
        }
      });

      if (timerRunning) {
        clearTimeout(timer);
        timerRunning = false;
      }

      const resultText = document.getElementById('result');
      if (correct) {
        resultText.textContent = '정답입니다!';
        resultText.className = 'result correct';
      } else {
        resultText.textContent = '오답입니다. 다시 시도해보세요!';
        resultText.className = 'result incorrect';
      }
    }

    function restartQuiz() {
      document.getElementById('overlay').style.display = 'none';
      document.getElementById('timeoutModal').style.display = 'none';
      startQuiz();
    }
  </script>
</body>
</html>
